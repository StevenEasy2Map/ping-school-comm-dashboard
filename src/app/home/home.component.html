<div *ngIf="loading" class="ping-loading-parent">
  <div class="ping-loading preloader-wrapper active">
    <div class="spinner-layer spinner-red-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div>
      <div class="gap-patch">
        <div class="circle"></div>
      </div>
      <div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!loading" class="container content">

  <div class="center-align" style="padding-bottom:0;">
    <img src="/assets/ping_logo_01.png" style="width:100px;margin-bottom:20px;"/>
  </div>

  <div class="row">
    <div role="alert" *ngIf="error" class="col s12">
      <span class="red-text text-darken-4">{{ error }}</span>
    </div>
  </div>

  <mat-tab-group class="home-page">
    <mat-tab *ngIf="mySchools && mySchools.length > 0" label="My Schools">

      <div class="tab-content">

        <h2 class="center-align" style="padding-bottom:0;">My Schools</h2>

        <mat-card class="home-card" *ngFor="let school of mySchools; let i = index">
          <mat-card-header>

            <button style="position:absolute;right:0;top:0;" (click)="editSchool(i)" mat-icon-button>
              <mat-icon aria-label="Edit">edit</mat-icon>
            </button>

            <button style="position:absolute;right:40px;top:0;" (click)="inviteUsersToSchool(i)" mat-icon-button>
              <mat-icon aria-label="Edit">share</mat-icon>
            </button>

            <mat-card-title>{{ school.name }}</mat-card-title>
          </mat-card-header>
          <img *ngIf="school.logo" mat-card-image src="{{school.logo}}" alt="{{school.logo}}">
          <mat-card-content>

            <div style="margin:0;padding:0;width: 100%;text-align: right">
              <div class="right">
                <button (click)="viewSchoolWideEventsCalendar(i)" mat-icon-button>
                  <mat-icon aria-label="Edit">event_note</mat-icon>
                </button>
              </div>
              <div class="right">
                <button (click)="viewSchoolWideNotices(i)" mat-icon-button>
                  <mat-icon aria-label="Edit">assignment</mat-icon>
                </button>
              </div>
              <div class="right">
                <button (click)="viewSchoolAdministrators(i)" mat-icon-button>
                  <mat-icon aria-label="Edit">group</mat-icon>
                </button>
              </div>

            </div>

            <pre style="clear:both;" class="notice-details-description">{{school.description}}</pre>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button (click)="createSchoolWideNotice(i)">Add School-Wide Notice</button>
            <button mat-raised-button (click)="createSchoolWideEvent(i)">Add School-Wide Event</button>
          </mat-card-actions>
        </mat-card>

      </div>

    </mat-tab>
    <mat-tab label="My Notices">
      <div class="tab-content">
        <h2 *ngIf="myNotices && myNotices.length > 0" class="center-align" style="padding-bottom:0;">My Notices</h2>

        <mat-card (click)="viewNoticeDetails(notice)" class="home-card pointer" *ngFor="let notice of myNotices; let i = index">
          <mat-card-header>
            <div [ngStyle]="{'background-image': getUrl(notice.group_image)}" *ngIf="notice.group_image"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ notice.title }}</mat-card-title>
            <mat-card-subtitle>{{notice.group_name}}</mat-card-subtitle>
          </mat-card-header>
          <img *ngIf="notice.image" mat-card-image src="{{notice.image}}" alt="{{notice.title}}">
          <mat-card-content>
            <p class="notice-date">Published {{ notice.show_date }}</p>
            <h5 *ngIf="!notice.school_wide" class="notice-sub-subtitle">{{notice.school_name}}</h5>
            <div [innerHTML]="notice.description"></div>
          </mat-card-content>
        </mat-card>

      </div>

    </mat-tab>
    <mat-tab label="My Events">

      <div class="tab-content">

        <h2 *ngIf="myEvents && myEvents.length > 0" class="center-align" style="padding-bottom:0;">My Events</h2>

        <mat-card (click)="viewEventDetails(event)" class="home-card pointer" *ngFor="let event of myEvents; let i = index">
          <mat-card-header>
            <div *ngIf="event.group_image" [ngStyle]="{'background-image': getUrl(event.group_image)}"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ event.title }}</mat-card-title>
            <mat-card-subtitle>{{event.group_name}}</mat-card-subtitle>
          </mat-card-header>
          <img *ngIf="event.image" mat-card-image src="{{event.image}}" alt="{{event.title}}">
          <mat-card-content>
            <p class="notice-date">{{ event.start_date | friendlydate }}</p>
            <h5 *ngIf="!event.school_wide" class="notice-sub-subtitle">{{event.school_name}}</h5>
            <div [innerHTML]="event.description" class="notice-details-description"></div>
          </mat-card-content>
        </mat-card>

      </div>


    </mat-tab>
    <mat-tab label="My Groups">

      <div class="tab-content">

        <a class="add-new-wrapper" (click)="addNewGroup()">
          <div class="btn-floating btn-large waves-effect waves-light orange">
            <i class="material-icons">add</i>
          </div>
          <span>Add a Group</span>
        </a>

        <h2 *ngIf="myGroups && myGroups.length > 0" style="clear:both;" class="center-align" style="padding-bottom:0;">My Groups</h2>

        <mat-card class="home-card" *ngFor="let group of myGroups; let i = index">
          <mat-card-header>

            <button style="position:absolute;right:0;top:0;" (click)="editGroup(i)" mat-icon-button>
              <mat-icon aria-label="Edit">edit</mat-icon>
            </button>

            <button style="position:absolute;right:40px;top:0;" (click)="inviteUsersToGroup(i)" mat-icon-button>
              <mat-icon aria-label="Edit">share</mat-icon>
            </button>

            <div *ngIf="group.school_logo" [ngStyle]="{'background-image': getUrl(group.school_logo)}"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ group.name }}</mat-card-title>
            <mat-card-subtitle>{{group.school_name}}</mat-card-subtitle>
          </mat-card-header>
          <img *ngIf="group.image" mat-card-image src="{{group.image}}" alt="{{group.name}}">
          <mat-card-content>

            <div style="margin:0;padding:0;width: 100%;text-align: right;color:#a2a2a2;">
              <div (click)="viewEventsCalendar(i)" *ngIf="group.event_count" class="right">
                <button  mat-icon-button>
                  <mat-icon aria-label="Edit">event_note</mat-icon>
                </button>
                <span class="stats-total">{{ group.event_count}} live event<span *ngIf="group.event_count !== 1">s</span></span>
              </div>
              <div (click)="viewGroupNotices(i)" *ngIf="group.notice_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">assignment</mat-icon>
                </button>
                <span class="stats-total">{{ group.notice_count}}  live notice<span *ngIf="group.notice_count !== 1">s</span></span>
              </div>
              <div (click)="viewGroupMembers(i)" *ngIf="group.member_count" class="right">
                <button  mat-icon-button>
                  <mat-icon aria-label="Edit">group</mat-icon>
                </button>
                <span class="stats-total">{{ group.member_count}} member<span *ngIf="group.member_count !== 1">s</span></span>
              </div>

            </div>

            <pre style="clear:both;" class="notice-details-description">{{group.description}}</pre>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button (click)="createNotice(i)">Add Notice</button>
            <button mat-raised-button (click)="createEvent(i)">Add Event</button>
            <div class="role">{{ group.role }}</div>
          </mat-card-actions>
        </mat-card>
      </div>

    </mat-tab>
  </mat-tab-group>


</div>
