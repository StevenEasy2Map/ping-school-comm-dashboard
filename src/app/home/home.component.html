<div *ngIf="loading" class="ping-loading-parent">
  <div class="ping-loading preloader-wrapper active">
    <div class="spinner-layer spinner-red-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div>
      <div class="gap-patch">
        <div class="circle"></div>
      </div>
      <div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!loading" class="container content">

  <div class="center-align" style="padding-bottom:0;">
    <img src="/assets/logo.svg" style="width:100px;margin-bottom:20px;"/>
  </div>

  <div class="row">
    <div role="alert" *ngIf="error" class="col s12">
      <span class="red-text text-darken-4">{{ error }}</span>
    </div>
  </div>

  <mat-tab-group (selectedTabChange)="tabChanged($event)" [(selectedIndex)]="selectedTabIndex" class="home-page">
    <mat-tab *ngIf="mySchools && mySchools.length > 0" label="My Schools">

      <div class="tab-content">

        <h2 class="center-align" style="padding-bottom:0;">My Schools</h2>

        <mat-card class="home-card" *ngFor="let school of mySchools; let i = index">
          <mat-card-header>

            <button style="position:absolute;right:0;top:0;" (click)="editSchool(i)" mat-icon-button>
              <mat-icon aria-label="Edit">edit</mat-icon>
            </button>

            <button style="position:absolute;right:40px;top:0;" (click)="inviteUsersToSchool(i)" mat-icon-button>
              <mat-icon aria-label="Edit">share</mat-icon>
            </button>

            <mat-card-title>{{ school.name }}</mat-card-title>
          </mat-card-header>
          <div class="center-align" *ngIf="school.logo">
            <img (click)="viewSchoolWideEventsCalendar(i)" class="home" *ngIf="school.logo" mat-card-image src="{{school.logo}}" alt="{{school.logo}}">
          </div>
          <mat-card-content>

            <div style="margin:0;padding:0;width: 100%;text-align: right;color:#a2a2a2;">
              <div (click)="viewSchoolAdministrators(i)" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">group</mat-icon>
                </button>
              </div>

              <div (click)="viewSchoolWideEventsCalendar(i)" *ngIf="school.event_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">event_note</mat-icon>
                </button>
                <span class="stats-total">{{ school.event_count}} live event<span *ngIf="school.event_count !== 1">s</span></span>
              </div>
              <div (click)="viewSchoolWideNotices(i)" *ngIf="school.notice_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">assignment</mat-icon>
                </button>
                <span class="stats-total">{{ school.notice_count}}  live notice<span *ngIf="school.notice_count !== 1">s</span></span>
              </div>

            </div>

            <div style="clear:both;" class="notice-details-description">{{school.description}}</div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button (click)="createSchoolWideNotice(i)">Add School-Wide Notice</button>
            <button mat-raised-button (click)="createSchoolWideEvent(i)">Add School-Wide Event</button>
          </mat-card-actions>
        </mat-card>

      </div>

    </mat-tab>
    <mat-tab label="My Notices">
      <div class="tab-content">
        <h2 *ngIf="myNotices && myNotices.length > 0" class="center-align" style="padding-bottom:0;">My Notices</h2>

        <h3 class="no-items" *ngIf="myNotices.length === 0">You don't currently have any live notices!</h3>

        <mat-card class="home-card pointer" *ngFor="let notice of myNotices; let i = index">

          <button (click)="hideEntity($event, 'notice', notice.id)" style="position:absolute;top:10px;right:10px;" mat-icon-button>
            <mat-icon aria-label="Example icon-button with a heart icon">clear</mat-icon>
          </button>

          <button *ngIf="notice.group_member_role === 'admin' || notice.group_member_role === 'owner' || notice.school_member_role === 'admin' || notice.school_member_role === 'owner'"
                  (click)="editEntity($event, 'notice', notice.id, notice.group_id, notice.school_id)"
                  style="position:absolute;top:10px;right:60px;" mat-icon-button>
            <mat-icon aria-label="Example icon-button with a heart icon">edit</mat-icon>
          </button>

          <mat-card-header (click)="viewNoticeDetails(notice)">
            <div [ngStyle]="{'background-image': getUrl(notice.group_image)}" *ngIf="notice.group_image"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ notice.title }}</mat-card-title>
            <mat-card-subtitle>{{notice.group_name}}</mat-card-subtitle>
          </mat-card-header>
          <div class="center-align" *ngIf="notice.image">
            <img class="home" (click)="viewNoticeDetails(notice)" mat-card-image src="{{notice.image}}" alt="{{notice.title}}">
          </div>
          <mat-card-content (click)="viewNoticeDetails(notice)">
            <p class="notice-date">Published {{ notice.show_date }}</p>
            <h5 *ngIf="!notice.school_wide" class="notice-sub-subtitle">{{notice.school_name}}</h5>
            <div class="notice-details-description" [innerHTML]="notice.description"></div>

          </mat-card-content>
        </mat-card>

      </div>

    </mat-tab>
    <mat-tab label="My Events">

      <div class="tab-content">

        <h2 *ngIf="myEvents && myEvents.length > 0" class="center-align" style="padding-bottom:0;">My Events</h2>

        <h3 class="no-items" *ngIf="myEvents.length === 0">You don't currently have any live events!</h3>

        <mat-card class="home-card pointer" *ngFor="let event of myEvents; let i = index">

          <button (click)="hideEntity($event, 'event', event.id)" style="position:absolute;top:10px;right:10px;" mat-icon-button>
            <mat-icon aria-label="Example icon-button with a heart icon">clear</mat-icon>
          </button>

          <button *ngIf="event.group_member_role === 'admin' || event.group_member_role === 'owner' || event.school_member_role === 'admin' || event.school_member_role === 'owner'"
                  (click)="editEntity($event, 'event', event.id, event.group_id, event.school_id)"
                  style="position:absolute;top:10px;right:60px;" mat-icon-button>
            <mat-icon aria-label="Example icon-button with a heart icon">edit</mat-icon>
          </button>

          <mat-card-header (click)="viewEventDetails(event)">
            <div *ngIf="event.group_image" [ngStyle]="{'background-image': getUrl(event.group_image)}"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ event.title }}</mat-card-title>
            <mat-card-subtitle>{{event.group_name}}</mat-card-subtitle>
          </mat-card-header>
          <div class="center-align" *ngIf="event.image">
            <img class="home" (click)="viewEventDetails(event)" *ngIf="event.image" mat-card-image src="{{event.image}}" alt="{{event.title}}">
          </div>
          <mat-card-content (click)="viewEventDetails(event)">
            <p class="notice-date">{{ event.start_date | friendlydatetime }}</p>
            <h5 *ngIf="!event.school_wide" class="notice-sub-subtitle">{{event.school_name}}</h5>
            <div [innerHTML]="event.description" class="notice-details-description"></div>
          </mat-card-content>
        </mat-card>

      </div>


    </mat-tab>
    <mat-tab label="My Groups">

      <div class="tab-content">

        <button mat-raised-button color="accent" class="add-group" (click)="addNewGroup()">Create new Group</button>


        <h2 *ngIf="myGroups && myGroups.length > 0" style="clear:both;" class="center-align" style="padding-bottom:0;">My Groups</h2>


        <h3 class="no-items" *ngIf="myGroups.length === 0">You aren't currently the administrator of any groups. Why not create one!</h3>


        <mat-card class="home-card" *ngFor="let group of myGroups; let i = index">
          <mat-card-header>

            <button style="position:absolute;right:0;top:0;" (click)="editGroup(i)" mat-icon-button>
              <mat-icon aria-label="Edit">edit</mat-icon>
            </button>

            <button style="position:absolute;right:40px;top:0;" (click)="inviteUsersToGroup(i)" mat-icon-button>
              <mat-icon aria-label="Edit">share</mat-icon>
            </button>

            <div *ngIf="group.school_logo" [ngStyle]="{'background-image': getUrl(group.school_logo)}"
                 mat-card-avatar class="home-header-image"></div>
            <mat-card-title>{{ group.name }}</mat-card-title>
            <mat-card-subtitle>{{group.school_name}}</mat-card-subtitle>
          </mat-card-header>
          <div class="center-align" *ngIf="group.image">
            <img (click)="viewEventsCalendar(i)" class="home"
                 *ngIf="group.image" mat-card-image src="{{group.image}}" alt="{{group.name}}">
          </div>
          <mat-card-content>

            <div style="margin:0;padding:0;width: 100%;text-align: right;color:#a2a2a2;">
              <div (click)="viewEventsCalendar(i)" *ngIf="group.event_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">event_note</mat-icon>
                </button>
                <span class="stats-total">{{ group.event_count}} live event<span *ngIf="group.event_count !== 1">s</span></span>
              </div>
              <div (click)="viewGroupNotices(i)" *ngIf="group.notice_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">assignment</mat-icon>
                </button>
                <span class="stats-total">{{ group.notice_count}} live notice<span *ngIf="group.notice_count !== 1">s</span></span>
              </div>
              <div (click)="viewGroupHomework(i)" *ngIf="group.homework_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">assignment</mat-icon>
                </button>
                <span class="stats-total">{{ group.homework_count}} homework item<span *ngIf="group.homework_count !== 1">s</span></span>
              </div>
              <div (click)="viewGroupMembers(i)" *ngIf="group.member_count" class="right">
                <button mat-icon-button>
                  <mat-icon aria-label="Edit">group</mat-icon>
                </button>
                <span class="stats-total">{{ group.member_count}} member<span *ngIf="group.member_count !== 1">s</span></span>
              </div>

            </div>

            <div style="clear:both;" class="notice-details-description">{{group.description}}</div>
          </mat-card-content>
          <mat-card-actions>
            <button *ngIf="group.include_homework" mat-raised-button (click)="createHomework(i)">Add Homework</button>
            <button mat-raised-button (click)="createNotice(i)">Add Notice</button>
            <button mat-raised-button (click)="createEvent(i)">Add Event</button>
            <div class="role">{{ group.role }}</div>
          </mat-card-actions>
        </mat-card>
      </div>

    </mat-tab>
  </mat-tab-group>

</div>
